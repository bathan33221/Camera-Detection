<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Hassan Jan — Hacker Detector (Upscaled)</title>
<style>
:root{
  --bg:#051014;--panel:#07121a;--neon:#57ff7b;--muted:#8fb3a1;--accent:#00e6ac;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--neon);font-family:ui-monospace,monospace;display:flex;flex-direction:column;align-items:center;padding:12px;gap:8px}
header{width:100%;max-width:900px;display:flex;align-items:center;justify-content:space-between;gap:12px}
h1{margin:0;font-size:18px;color:var(--neon)}
.sub{color:var(--muted);font-size:12px}
#wrap{width:100%;max-width:900px;display:flex;flex-direction:column;align-items:center;gap:8px}
.viewer{position:relative;width:100%;background:#000;border-radius:12px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,0.6)}
video{width:100%;height:auto;display:block;transform:scaleX(1)}
canvas{position:absolute;left:0;top:0;pointer-events:none}
.ui{width:100%;display:flex;gap:8px;flex-wrap:wrap;justify-content:space-between;align-items:center;padding:8px;background:var(--panel);border-radius:10px;border:1px solid rgba(0,255,130,0.04)}
.left, .right{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
button,input,select{background:transparent;border:1px solid rgba(90,255,150,0.06);color:var(--neon);padding:6px 10px;border-radius:8px;font-family:inherit}
button.primary{background:linear-gradient(90deg, rgba(0,255,140,0.06), rgba(0,230,120,0.03));border:1px solid rgba(0,255,140,0.18);box-shadow:0 6px 18px rgba(0,200,120,0.03)}
.small{font-size:12px;color:var(--muted)}
.badge{background:rgba(0,0,0,0.3);padding:6px 8px;border-radius:8px;border:1px solid rgba(90,255,150,0.04);font-weight:600}
.terminal{width:100%;max-width:900px;background:#021212;border-radius:10px;padding:10px;color:var(--neon);font-size:13px;border:1px solid rgba(0,255,140,0.03)}
footer{color:var(--muted);font-size:12px;opacity:0.9}
</style>
</head>
<body>
<header>
  <div>
    <h1>Hassan Jan — Hacker Detector (Upscaled)</h1>
    <div class="sub">Optimized for Tecno Spark 10 Pro</div>
  </div>
  <div class="badge">v1.1 • Local</div>
</header>

<div id="wrap">
  <div class="viewer">
    <video id="video" autoplay playsinline muted></video>
    <canvas id="overlay"></canvas>
    <div style="position:absolute;right:10px;top:10px" class="badge" id="status">Loading models…</div>
  </div>

  <div class="ui">
    <div class="left">
      <button id="toggleBtn" class="primary">Stop</button>
      <button id="snapshotBtn">Snapshot</button>
      <button id="downloadJSON">Download JSON</button>
      <label><input id="showBoxes" type="checkbox" checked> Show boxes</label>
    </div>
    <div class="right">
      <span class="small">Mode:
        <select id="mode">
          <option value="balanced">Balanced</option>
          <option value="fast">Fast</option>
          <option value="accurate">Accurate</option>
        </select>
      </span>
      <span class="small">FPS: <span id="fps">—</span></span>
      <span class="small">Det: <span id="detcount">—</span></span>
    </div>
  </div>

  <div class="terminal small" id="log">
    <div>> Ready. Upscaled live camera & fast detection.</div>
  </div>
</div>
<footer>All processing runs locally — camera feed is upscaled for clarity.</footer>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.4.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>
<script>
const video = document.getElementById('video');
const overlay = document.getElementById('overlay');
const statusEl = document.getElementById('status');
const fpsEl = document.getElementById('fps');
const detCountEl = document.getElementById('detcount');
const logEl = document.getElementById('log');

const toggleBtn = document.getElementById('toggleBtn');
const snapshotBtn = document.getElementById('snapshotBtn');
const downloadJSONBtn = document.getElementById('downloadJSON');
const showBoxesChk = document.getElementById('showBoxes');
const modeSel = document.getElementById('mode');

let detector=null, detecting=true, lastDetections=[];
let processW=320, processH=240, detInterval=220;
let loopHandle=null, fps=0, frames=0, lastTime=performance.now();
let off=document.createElement('canvas'), offCtx=off.getContext('2d');

async function startCamera(){
  try{await tf.setBackend('webgl');}catch(e){}
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment',width:{ideal:1280},height:{ideal:720}},audio:false});
    video.srcObject=stream;
    await video.play();
    resizeCanvas();
    window.addEventListener('resize',resizeCanvas);
    logEl.innerHTML+="<div>> Camera started</div>";
  }catch(e){alert('Camera access denied: '+e.message);statusEl.textContent='Camera error';throw e;}
}

function resizeCanvas(){
  overlay.width=video.clientWidth;
  overlay.height=video.clientHeight;
  off.width=processW; off.height=processH;
}

async function loadModel(){
  statusEl.textContent='Loading coco-ssd...';
  detector = await cocoSsd.load();
  statusEl.textContent='Model ready';
}

function pickColor(s){
  let h=0;for(let i=0;i<s.length;i++)h=(h*31+s.charCodeAt(i))%360;
  return `hsl(${h}deg 85% 55%)`;
}

function hexToRgba(hsl,a=1){const c=document.createElement('canvas');c.width=1;c.height=1;const cx=c.getContext('2d');cx.fillStyle=hsl;cx.fillRect(0,0,1,1);const d=cx.getImageData(0,0,1,1).data;return `rgba(${d[0]},${d[1]},${d[2]},${a})`;}

// detection loop
async function detectLoop(){
  if(!detecting||!detector) return;
  const start=performance.now();
  offCtx.drawImage(video,0,0,off.width,off.height);
  let preds=[];
  try{preds=await detector.detect(off);}catch(e){preds=[];}
  lastDetections=preds;
  draw(preds);
  frames++; const now=performance.now();
  if(now-lastTime>=1000){fps=Math.round((frames*1000)/(now-lastTime));frames=0;lastTime=now;fpsEl.textContent=fps;}
  detCountEl.textContent=preds.length;
  const elapsed=performance.now()-start;
  const delay=Math.max(60,detInterval-elapsed);
  loopHandle=setTimeout(detectLoop,delay);
}

// draw detections
function draw(preds){
  overlayCtx.clearRect(0,0,overlay.width,overlay.height);
  const scaleX=overlay.width/off.width, scaleY=overlay.height/off.height;
  if(!showBoxesChk.checked) return;
  for(const p of preds){
    const [x,y,w,h]=p.bbox;
    const sx=x*scaleX, sy=y*scaleY, sw=w*scaleX, sh=h*scaleY;
    const color=pickColor(p.class);
    const bg=hexToRgba(color,0.75);
    overlayCtx.lineWidth=Math.max(2,Math.round(overlay.width*0.004));
    overlayCtx.strokeStyle=color;
    overlayCtx.beginPath(); overlayCtx.rect(sx,sy,sw,sh); overlayCtx.stroke();
    overlayCtx.font=`${Math.max(11,Math.round(overlay.width*0.028))}px monospace`;
    const txt=p.class, pad=6, txtW=overlayCtx.measureText(txt).width;
    overlayCtx.fillStyle=bg;
    overlayCtx.fillRect(sx,Math.max(0,sy-22),txtW+pad*2,20);
    overlayCtx.fillStyle='#001';
    overlayCtx.fillText(txt,sx+pad,Math.max(0,sy-20));
  }
}

// snapshot
snapshotBtn.addEventListener('click',()=>{
  const c=document.createElement('canvas'); c.width=overlay.width; c.height=overlay.height;
  const ctx=c.getContext('2d');
  ctx.drawImage(video,0,0,c.width,c.height);
  ctx.drawImage(overlay,0,0,c.width,c.height);
  const data=c.toDataURL('image/png'); const w=window.open(); w.document.write('<img src="'+data+'">');
});

// download JSON
downloadJSONBtn.addEventListener('click',()=>{
  const data=JSON.stringify({ts:Date.now(),detections:lastDetections},null,2);
  const blob=new Blob([data],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='detections.json'; a.click(); URL.revokeObjectURL(url);
});

// toggle detection
toggleBtn.addEventListener('click',()=>{
  detecting=!detecting; toggleBtn.textContent=detecting?'Stop':'Start';
  if(detecting) detectLoop(); else if(loopHandle) clearTimeout(loopHandle);
});

// mode
modeSel.addEventListener('change',()=>{
  const m=modeSel.value;
  if(m==='fast'){detInterval=140;processW=240;processH=160;}
  else if(m==='accurate'){detInterval=380;processW=480;processH=360;}
  else {detInterval=220;processW=320;processH=240;}
  off.width=processW; off.height=processH;
});

// init
(async()=>{
  await startCamera();
  await loadModel();
  statusEl.textContent='Ready — upscaled feed';
  detectLoop();
})();
</script>
</body>
</html>
