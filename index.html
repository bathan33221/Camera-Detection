<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live AI Camera</title>
<style>
  body { font-family: sans-serif; text-align: center; background: #111; color: #fff; }
  video, canvas { max-width: 100%; border-radius: 10px; margin-top: 10px; }
  #controls { margin-top: 10px; }
</style>
</head>
<body>
<h1>Live AI Camera</h1>
<video id="video" autoplay playsinline width="360" height="270"></video>
<canvas id="canvas" width="360" height="270"></canvas>
<div id="controls">
  <button id="toggleBtn">Toggle Detection</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.4.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let model, detecting = true;

// Access phone camera
navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio: false })
.then(stream => { video.srcObject = stream; })
.catch(err => { alert("Camera access denied: " + err); });

// Load object detection model
cocoSsd.load().then(m => { model = m; console.log("Model loaded"); detectFrame(); });

// Toggle detection
document.getElementById('toggleBtn').addEventListener('click', () => {
  detecting = !detecting;
});

// Main detection loop
async function detectFrame() {
  if (!model) return requestAnimationFrame(detectFrame);

  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  if (detecting) {
    const predictions = await model.detect(canvas);

    // Draw bounding boxes
    predictions.forEach(pred => {
      ctx.strokeStyle = 'lime';
      ctx.lineWidth = 2;
      ctx.strokeRect(pred.bbox[0], pred.bbox[1], pred.bbox[2], pred.bbox[3]);
      ctx.fillStyle = 'lime';
      ctx.font = '14px sans-serif';
      ctx.fillText(pred.class + ' ' + Math.round(pred.score * 100) + '%', pred.bbox[0], pred.bbox[1] > 10 ? pred.bbox[1]-5 : 10);

      // If detected object is a "card" or "book" try OCR
      if (pred.class === 'book' || pred.class === 'cell phone') { // Approximation for cards
        const [x, y, w, h] = pred.bbox;
        const cardImage = ctx.getImageData(x, y, w, h);
        Tesseract.recognize(cardImage, 'eng', { logger: m => console.log(m) })
          .then(({ data: { text } }) => {
            ctx.fillStyle = 'yellow';
            ctx.fillText(text.trim(), x, y + h + 15);
          });
      }
    });
  }

  requestAnimationFrame(detectFrame);
}
</script>
</body>
</html>
